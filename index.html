<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Eterniverse - Asystent Redagowania z Profilami</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh;
  }
  header {
    background: #1e1e1e;
    padding: 1rem;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
  }
  #console, #editor {
    width: 90%;
    margin: 1rem auto;
    background: #222;
    color: #eee;
    border: none;
    border-radius: 5px;
    padding: 10px;
    font-size: 1rem;
    resize: vertical;
    min-height: 100px;
  }
  #output, #suggestions {
    width: 90%;
    margin: 0 auto 1rem auto;
    background: #1a1a1a;
    padding: 10px;
    border-radius: 5px;
    min-height: 60px;
    overflow-y: auto;
  }
  button {
    margin: 0.5rem 0.3rem;
    padding: 0.5rem 1rem;
    background: #3a3a3a;
    border: none;
    border-radius: 4px;
    color: #eee;
    cursor: pointer;
  }
  button:hover {
    background: #555;
  }
  .suggestion {
    background: #333;
    padding: 5px;
    margin: 3px 0;
    border-radius: 3px;
  }
  .suggestion button {
    margin-left: 1rem;
    font-size: 0.9rem;
  }
  #profileSelector {
    margin: 1rem auto;
    width: 200px;
    background: #222;
    color: #eee;
    border: none;
    border-radius: 5px;
    padding: 5px;
    font-size: 1rem;
    cursor: pointer;
  }
</style>
</head>
<body>
<header>Eterniverse - Bella Asystent Redakcyjny</header>

<div style="text-align:center;">
  <label for="profileSelector">Wybierz profil redakcyjny: </label>
  <select id="profileSelector" title="Wybierz profil redakcyjny">
    <option value="amazon">Amazon</option>
    <option value="wattpad">Wattpad</option>
  </select>
</div>

<textarea id="console" placeholder="Wpisz polecenie lub tekst do redagowania..."></textarea>
<div style="text-align:center;">
  <button id="startRecBtn">üéôÔ∏è Rozpocznij dyktowanie</button>
  <button id="stopRecBtn" disabled>‚èπÔ∏è Zatrzymaj dyktowanie</button>
  <button id="executeBtn">Wykonaj polecenie / Sprawd≈∫ tekst</button>
  <button id="exportBtn">Eksportuj do Word (.docx)</button>
</div>

<h3 style="text-align:center;">Edytowany tekst:</h3>
<textarea id="editor" placeholder="Tutaj pojawi siƒô i bƒôdzie mo≈ºna edytowaƒá tekst..."></textarea>

<h3 style="text-align:center;">Sugestie i podpowiedzi:</h3>
<div id="suggestions"></div>

<div id="output"></div>

<script src="https://cdn.jsdelivr.net/npm/docx@7.3.0/build/index.min.js"></script>
<script>
(async () => {
  const { Document, Packer, Paragraph, HeadingLevel } = docx;

  const STORAGE_KEY = 'eterniverse_assistant_data_profiles';
  let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  if (!data.amazon) data.amazon = { acceptedSuggestions: [] };
  if (!data.wattpad) data.wattpad = { acceptedSuggestions: [] };

  const consoleEl = document.getElementById('console');
  const editorEl = document.getElementById('editor');
  const suggestionsEl = document.getElementById('suggestions');
  const outputEl = document.getElementById('output');
  const profileSelector = document.getElementById('profileSelector');

  let currentProfile = profileSelector.value;

  profileSelector.onchange = () => {
    currentProfile = profileSelector.value;
    suggestionsEl.innerHTML = '';
    outputEl.textContent = `Prze≈ÇƒÖczono na profil: ${currentProfile.charAt(0).toUpperCase() + currentProfile.slice(1)}`;
    speakText(`Prze≈ÇƒÖczono na profil ${currentProfile}`);
  };

  // Rozpoznawanie mowy
  let recognition;
  let recognizing = false;
  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'pl-PL';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript.trim();
      consoleEl.value += (consoleEl.value ? ' ' : '') + transcript;
      speakText(`Rozpoznano: ${transcript}`);
    };

    recognition.onstart = () => {
      recognizing = true;
      startRecBtn.disabled = true;
      stopRecBtn.disabled = false;
      speakText('Rozpoczƒôto dyktowanie');
    };

    recognition.onend = () => {
      recognizing = false;
      startRecBtn.disabled = false;
      stopRecBtn.disabled = true;
      speakText('Zatrzymano dyktowanie');
    };

    recognition.onerror = (event) => {
      speakText('WystƒÖpi≈Ç b≈ÇƒÖd rozpoznawania mowy: ' + event.error);
    };
  } else {
    alert('Twoja przeglƒÖdarka nie wspiera rozpoznawania mowy.');
  }

  document.getElementById('startRecBtn').onclick = () => {
    if (!recognizing) recognition.start();
  };
  document.getElementById('stopRecBtn').onclick = () => {
    if (recognizing) recognition.stop();
  };

  function speakText(text) {
    if (!window.speechSynthesis) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pl-PL';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utterance);
  }

  function amazonSuggestions(text) {
    const suggestions = [];

    const words = text.toLowerCase().match(/\b\w+\b/g) || [];
    const wordCounts = {};
    words.forEach(w => wordCounts[w] = (wordCounts[w] || 0) + 1);
    Object.entries(wordCounts).forEach(([word, count]) => {
      if (count > 5) {
        suggestions.push(`S≈Çowo "word"powtarzasiƒô{word}" powtarza siƒôword"powtarzasiƒô{count} razy - rozwa≈º u≈ºycie synonim√≥w.`);
      }
    });

    const sentences = text.match(/[^\.!\?]+[\.!\?]+/g) || [];
    sentences.forEach((s, i) => {
      const len = s.trim().split(/\s+/).length;
      if (len > 25) {
        suggestions.push(`Zdanie nr i+1jestbardzod≈Çugie({i+1} jest bardzo d≈Çugie (i+1jestbardzod≈Çugie({len} s≈Ç√≥w) - rozwa≈º podzia≈Ç na kr√≥tsze.`);
      }
    });

    const marketingPhrases = [
      'najlepszy',
      'idealny',
      'unikalny',
      'niezwyk≈Çy',
      'doskona≈Çy',
      'rewolucyjny',
      'ekskluzywny',
      'najwy≈ºszej jako≈õci',
    ];
    marketingPhrases.forEach(phrase => {
      const reg = new RegExp(`\\b${phrase}\\b`, 'i');
      if (reg.test(text)) {
        suggestions.push(`U≈ºyto frazy marketingowej: "${phrase}". Upewnij siƒô, ≈ºe jest adekwatna.`);
      }
    });

    const seoKeywords = ['darmowa wysy≈Çka', 'gwarancja', 'bezpieczne zakupy', 'promocja', 'nowo≈õƒá'];
    seoKeywords.forEach(keyword => {
      const reg = new RegExp(`\\b${keyword}\\b`, 'i');
      if (!reg.test(text)) {
        suggestions.push(`Brak frazy SEO: "${keyword}". Rozwa≈º dodanie dla lepszej widoczno≈õci.`);
      }
    });

    return suggestions;
  }

  function wattpadSuggestions(text) {
    const suggestions = [];

    const emotionWords = ['smutny', 'szczƒô≈õliwy', 'z≈Çy', 'zaskoczony', 'przera≈ºony', 'zakochany'];
    let emotionCount = 0;
    emotionWords.forEach(word => {
      const reg = new RegExp(`\\b${word}\\b`, 'i');
      if (reg.test(text)) emotionCount++;
    });
    if (emotionCount < 2) {
      suggestions.push('Dodaj wiƒôcej emocji i opis√≥w uczuƒá, by zaanga≈ºowaƒá czytelnika.');
    }

    const sentences = text.match(/[^\.!\?]+[\.!\?]+/g) || [];
    sentences.forEach((s, i) => {
      const len = s.trim().split(/\s+/).length;
      if (len < 4) {
        suggestions.push(`Zdanie nr i+1jestbardzokroÀätkie({i+1} jest bardzo kr√≥tkie (i+1jestbardzokroÀätkie({len} s≈Çowa) - rozwa≈º rozwiniƒôcie.`);
      }
    });

    if (!/[‚Äû‚Äù"']/.test(text)) {
      suggestions.push('Dodaj dialogi, by tekst by≈Ç bardziej dynamiczny i anga≈ºujƒÖcy.');
    }

    if (!/metafora|por√≥wnanie|symbolika/i.test(text)) {
      suggestions.push('Rozwa≈º u≈ºycie metafor, por√≥wna≈Ñ lub symboliki dla wzbogacenia stylu.');
    }

    return suggestions;
  }

  function generateSampleText(profile) {
    if (profile === 'amazon') {
      return `Ten produkt to doskona≈Çy wyb√≥r dla ka≈ºdego, kto szuka najwy≈ºszej jako≈õci i niezawodno≈õci. Zapewnia wyjƒÖtkowƒÖ trwa≈Ço≈õƒá oraz komfort u≈ºytkowania. Skorzystaj z naszej promocji i ciesz siƒô darmowƒÖ wysy≈ÇkƒÖ!`;
    }
    if (profile === 'wattpad') {
      return `By≈Ç to smutny wiecz√≥r, gdy Anna spojrza≈Ça w dal. W jej oczach kry≈Ça siƒô tƒôsknota, kt√≥rej nie potrafi≈Ça wyraziƒá s≈Çowami. "Co je≈õli wszystko siƒô zmieni?" ‚Äî zastanawia≈Ça siƒô cicho, czujƒÖc ch≈Ç√≥d na sk√≥rze.`;
    }
    return '';
  }

  function addAcceptedSuggestion(sug) {
    if (!data[currentProfile].acceptedSuggestions.includes(sug)) {
      data[currentProfile].acceptedSuggestions.push(sug);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
  }

  function getSuggestionsForProfile(text) {
    if (currentProfile === 'amazon') return amazonSuggestions(text);
    if (currentProfile === 'wattpad') return wattpadSuggestions(text);
    return [];
  }

  function processConsoleText(input) {
    const cmd = input.trim();
    if (!cmd) return;

    const parts = cmd.split(/\s+/);
    const cmdUpper = parts[0].toUpperCase();

    if (cmdUpper === 'REDAGUJ' || cmdUpper === 'REDAGUJ TEKST') {
      editorEl.value = consoleEl.value;
      suggestionsEl.innerHTML = '';
      outputEl.textContent = 'Tekst przeniesiony do edytora. Kliknij "Wykonaj polecenie / Sprawd≈∫ tekst", aby zobaczyƒá sugestie.';
      speakText('Tekst przeniesiony do edytora. Mo≈ºesz teraz sprawdziƒá sugestie.');
      return;
    }

    if (cmdUpper === 'PODPOWIED≈π') {
      const text = editorEl.value.trim();
      if (!text) {
        outputEl.textContent = 'Edytor jest pusty. Wpisz tekst do redagowania.';
        speakText('Edytor jest pusty. Wpisz tekst do redagowania.');
        return;
      }
      let sug = getSuggestionsForProfile(text);
      sug = sug.filter(s => !data[currentProfile].acceptedSuggestions.includes(s));
      suggestionsEl.innerHTML = '';
      if (sug.length === 0) {
        suggestionsEl.textContent = 'Brak nowych sugestii.';
        speakText('Brak nowych sugestii.');
      } else {
        sug.forEach(str => {
          const div = document.createElement('div');
          div.classList.add('suggestion');
          div.textContent = str;
          const acceptBtn = document.createElement('button');
          acceptBtn.textContent = 'Akceptuj';
          acceptBtn.onclick = () => {
            addAcceptedSuggestion(str);
            div.style.opacity = '0.5';
            speakText('Sugestia zaakceptowana.');
          };
          div.appendChild(acceptBtn);
          suggestionsEl.appendChild(div);
        });
        speakText(`Znaleziono ${sug.length} sugestii.`);
      }
      return;
    }

    if (cmdUpper === 'EKSPORTUJ') {
      if (!editorEl.value.trim()) {
        outputEl.textContent = 'Edytor jest pusty. Nie mo≈ºna eksportowaƒá.';
        speakText('Edytor jest pusty. Nie mo≈ºna eksportowaƒá.');
        return;
      }
      exportToWord(`Opis_${currentProfile.charAt(0).toUpperCase() + currentProfile.slice(1)}`, editorEl.value.trim());
      return;
    }

    if (cmdUpper === 'GENERUJ') {
      if (parts[1] && parts[1].toUpperCase() === 'TEKST') {
        const sampleText = generateSampleText(currentProfile);
        editorEl.value = sampleText;
        suggestionsEl.innerHTML = '';
        outputEl.textContent = `Wygenerowano przyk≈Çadowy tekst dla profilu ${currentProfile}.`;
        speakText(`Wygenerowano przyk≈Çadowy tekst dla profilu ${currentProfile}.`);
        return;
      }
    }

    editorEl.value = input;
    suggestionsEl.innerHTML = '';
    outputEl.textContent = 'Tekst za≈Çadowany do edytora.';
    speakText('Tekst za≈Çadowany do edytora.');
  }

  document.getElementById('executeBtn').onclick = () => {
    processConsoleText(consoleEl.value);
  };

  document.getElementById('exportBtn').onclick = () => {
    if (!editorEl.value.trim()) {
      outputEl.textContent = 'Edytor jest pusty. Nie mo≈ºna eksportowaƒá.';
      speakText('Edytor jest pusty. Nie mo≈ºna eksportowaƒá.');
      return;
    }
    exportToWord(`Opis_${currentProfile.charAt(0).toUpperCase() + currentProfile.slice(1)}`, editorEl.value.trim());
  };

  async function exportToWord(title, text) {
    const doc = new Document({
      sections: [{
        children: [
          new Paragraph({
            text: title,
            heading: HeadingLevel.HEADING_1,
            thematicBreak: true,
          }),
          new Paragraph(text),
        ],
      }],
    });
    const blob = await Packer.toBlob(doc);
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${title.replace(/\s+/g, '_')}.docx`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    outputEl.textContent = `Eksportowano plik ${a.download}`;
    speakText('Plik zosta≈Ç wyeksportowany.');
  }
})();
</script>
</body>
</html>
