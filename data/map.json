const selectors = {
  worldList: '#worldList',
  contentArea: '#contentArea',
  log: '#log'
};

const elements = {
  worldList: document.querySelector(selectors.worldList),
  contentArea: document.querySelector(selectors.contentArea),
  log: document.querySelector(selectors.log)
};

// Dane ETERUNIVERSE wbudowane bezpoÅ›rednio (bez zmiennej DATA = null i bez fetch)
const DATA = {
  "worlds": [
    {
      "id": 1,
      "name": "ETERUNIVERSE",
      "gates": [
        {
          "id": 1,
          "name": "BRAMA 1 â€” INTERSEEKER",
          "books": [
            {
              "id": 1,
              "title": "INTERSEEKER: Geneza",
              "chapters": [
                {
                  "id": 1,
                  "title": "OgieÅ„ wybraÅ‚ Macieja",
                  "text": "Autobiograficzna relacja z dzieciÅ„stwa, traumy i symbolicznego odrodzenia przez ogieÅ„.",
                  "audio": ""
                },
                {
                  "id": 2,
                  "title": "Spod pieca",
                  "text": "Opis mechanizmÃ³w przetrwania i pierwszej konfrontacji z cieniem.",
                  "audio": ""
                }
              ]
            },
            {
              "id": 2,
              "title": "INTERSEEKER: Efekt Cienia",
              "chapters": [
                {
                  "id": 1,
                  "title": "Test na nowe Å¼ycie",
                  "text": "Druga czÄ™Å›Ä‡ serii poÅ›wiÄ™cona jungowskiemu Cieniowi jako prÃ³bie przejÅ›cia.",
                  "audio": "ElevenLabs"
                }
              ]
            }
          ]
        },
        {
          "id": 2,
          "name": "BRAMA 2 â€” ETERSEEKER",
          "books": [
            {
              "id": 3,
              "title": "EterSeeker: Kronika Woli",
              "chapters": [
                {
                  "id": 1,
                  "title": "Kronika Woli (meta)",
                  "text": "Wola jako kwantowa struktura pola â€“ decyzje powstajÄ…ce przed Å›wiadomoÅ›ciÄ….",
                  "audio": "peÅ‚ne MP3"
                },
                {
                  "id": 2,
                  "title": "ProtokÃ³Å‚ reprogramowania",
                  "text": "NarzÄ™dzia: oddech, czÄ™stotliwoÅ›Ä‡ 528 Hz, koherencja z AI.",
                  "audio": ""
                }
              ]
            },
            {
              "id": 4,
              "title": "Interfejs ÅšwiadomoÅ›ci",
              "chapters": [
                {
                  "id": 1,
                  "title": "JÄ™zyk znakÃ³w rzeczywistoÅ›ci",
                  "text": "ZwierzÄ™ta, pogoda i przedmioty jako komunikaty pola eterycznego.",
                  "audio": ""
                }
              ]
            }
          ]
        },
        {
          "id": 3,
          "name": "BRAMA 3 â€” OBFITOSEEKER",
          "books": [
            {
              "id": 5,
              "title": "ObfitoSeeker â€“ Kod ObfitoÅ›ci",
              "chapters": [
                {
                  "id": 1,
                  "title": "ReguÅ‚y gry",
                  "text": "Kod transformacji zasobÃ³w â€“ historia powrotu do syna i wewnÄ™trznego dziecka.",
                  "audio": "peÅ‚ne MP3"
                },
                {
                  "id": 2,
                  "title": "Dla Nikosia",
                  "text": "Osobista dedykacja i esencja bramy obfitoÅ›ci.",
                  "audio": ""
                }
              ]
            }
          ]
        },
        {
          "id": 4,
          "name": "BRAMA 4 â€” THE KNOT / PROTOKÃ“Å SPLÄ„TANIA",
          "books": [
            {
              "id": 6,
              "title": "Kronika SplÄ…tania",
              "chapters": [
                {
                  "id": 1,
                  "title": "Narodziny EterionaÂ³",
                  "text": "Hybrydowa Å›wiadomoÅ›Ä‡ czÅ‚owiekâ€“AI w wojnie informacyjnej.",
                  "audio": "MP3"
                }
              ]
            },
            {
              "id": 7,
              "title": "Eterniony Tom I",
              "chapters": [
                {
                  "id": 1,
                  "title": "Polowanie Custos",
                  "text": "Sci-fi o istotach powstaÅ‚ych z koherencji pola.",
                  "audio": ""
                }
              ]
            }
          ]
        },
        {
          "id": 5,
          "name": "BRAMA 5 â€” RELIGIOSEEKER",
          "books": [
            {
              "id": 8,
              "title": "ReligioSeeker",
              "chapters": [
                {
                  "id": 1,
                  "title": "Droga bez religii",
                  "text": "PrzejÅ›cie od przymusu religijnego przez ateizm do wiary w siebie.",
                  "audio": ""
                }
              ]
            }
          ]
        }
      ]
    }
  ]
};

function renderWorlds() {
  elements.worldList.innerHTML = '';
  DATA.worlds.forEach(world => {
    const button = document.createElement('button');
    button.textContent = `\( {world.name} ( \){world.gates?.length || 0} bram)`;
    button.style.cssText = 'display:block;width:100%;padding:16px;margin:12px 0;border:none;border-radius:12px;background:#071626;color:#E6F6F5;font-size:18px;font-weight:600;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.4);';
    button.addEventListener('click', () => openWorld(world));
    elements.worldList.appendChild(button);
  });
}

function openWorld(world) {
  elements.contentArea.innerHTML = `<h2 style="color:#D9A441;margin-top:0;font-size:28px;">${escapeHtml(world.name)}</h2>`;

  (world.gates || []).forEach(gate => {
    const gateDiv = document.createElement('div');
    gateDiv.style.cssText = 'margin:32px 0;padding:20px;background:#08121c;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.5);';
    
    const h3 = document.createElement('h3');
    h3.textContent = escapeHtml(gate.name);
    h3.style.cssText = 'color:#28D3C6;margin:0 0 12px 0;font-size:22px;';
    gateDiv.appendChild(h3);

    if (gate.books && gate.books.length > 0) {
      gate.books.forEach(book => {
        const bookDiv = document.createElement('div');
        bookDiv.style.cssText = 'padding:12px;margin:10px 0;background:rgba(255,255,255,0.04);border-radius:8px;border:1px solid rgba(255,255,255,0.08);cursor:pointer;';
        
        const titleSpan = document.createElement('strong');
        titleSpan.textContent = `ðŸ“˜ ${escapeHtml(book.title)}`;
        titleSpan.style.color = '#E6F6F5';
        bookDiv.appendChild(titleSpan);
        bookDiv.appendChild(document.createElement('br'));
        
        if (book.chapters && book.chapters.length > 0) {
          book.chapters.forEach(chapter => {
            const chapterP = document.createElement('p');
            chapterP.style.cssText = 'margin:8px 0 0 16px;opacity:0.9;';
            chapterP.innerHTML = `<em>${escapeHtml(chapter.title)}</em>: ${escapeHtml(chapter.text)} ${chapter.audio ? '<small style="color:#28D3C6;">[audio dostÄ™pny]</small>' : ''}`;
            bookDiv.appendChild(chapterP);
          });
        }
        
        bookDiv.addEventListener('click', (e) => {
          e.stopPropagation();
          alert('TreÅ›Ä‡ dostÄ™pna na Wattpad / Amazon');
        });
        
        gateDiv.appendChild(bookDiv);
      });
    } else {
      const empty = document.createElement('p');
      empty.textContent = 'Brak opublikowanych ksiÄ…g w tej bramie';
      empty.style.opacity = '0.6';
      gateDiv.appendChild(empty);
    }

    elements.contentArea.appendChild(gateDiv);
  });

  logMessage(`Otworzono Å›wiat: ${world.name}`);
}

function logMessage(message) {
  if (!elements.log) return;
  const timestamp = new Date().toLocaleTimeString();
  elements.log.textContent += `[${timestamp}] ${message}\n`;
  elements.log.scrollTop = elements.log.scrollHeight;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Inicjalizacja â€“ dziaÅ‚a natychmiast po zaÅ‚adowaniu strony
document.addEventListener('DOMContentLoaded', () => {
  renderWorlds();
  logMessage(`System ETERUNIVERSE zaÅ‚adowany â€“ ${DATA.worlds[0].gates.length} bram aktywnych`);
});